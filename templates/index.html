<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Spotify-Filter-Song-by-Text Search</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script>
        async function search() {
            const query = document.getElementById('query').value;
            const k = document.getElementById('topk').value;
            const language = document.getElementById('language').value;
            const response = await fetch(`/search?query=${query}&k=${k}&language=${language}`);
            const data = await response.json();
            const results = data.results;
            const time = data.time;
            
            // get
            const getUrlButton = document.getElementById('get-url-button');
            getUrlButton.href = `http://localhost:5000/search?query=${query}&k=${k}&language=${language}`;
            // Habilitar el botón de GET
            getUrlButton.classList.remove('disabled');

            const resultDiv = document.getElementById('results');
            resultDiv.innerHTML = '';

            const timeDiv = document.createElement('div');
            timeDiv.className = 'alert alert-info';
            timeDiv.innerText = `Tiempo de búsqueda: ${time.toFixed(4)} segundos`;
            resultDiv.appendChild(timeDiv);

            const table = document.createElement('table');
            table.className = 'table table-striped';
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th>Canción ID</th>
                <th>Letra</th>
                <th>Datos de la canción</th>
                <th>Artista</th>
                <th>Score</th>
            `;
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');

            for (const result of results) {
                const docResponse = await fetch(`/document?doc_id=${result.doc_id}`);
                const docData = await docResponse.json();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.doc_id}</td>
                    <td>${docData.lyrics}</td>
                    <td>${docData.track_name}</td>
                    <td>${docData.track_artist}</td>
                    <td>${result.score}</td>
                `;
                tbody.appendChild(row);
            }

            table.appendChild(tbody);
            resultDiv.appendChild(table);
        }
    </script>
</head>

<body>
    <div class="container">
        <h1 class="mt-5">Spotify-Filter-Song-by-Text Search</h1>
        <div class="form-group">
            <input type="text" id="query" class="form-control" placeholder="Ingrese su consulta">
        </div>
        <div class="form-group">
            <input type="number" id="topk" class="form-control" value="5">
        </div>
        <div class="form-group">
            <select id="language" class="form-control">
                <option value="es">Español</option>
                <option value="en">Inglés</option>
            </select>
        </div>
        <!-- Envolver los botones en un div y usar las clases de Bootstrap para alinearlos -->
        <div class="form-group d-flex">
            <button onclick="search()" class="btn btn-primary mr-2">Buscar</button>
            <!-- Botón para hacer el GET -->
            <a id="get-url-button" target="_blank" class="btn btn-secondary disabled">Ver GET</a>
        </div>
        <div id="results" class="mt-5"></div>
    </div>
</body>

</html>
